var SAVEWORDTEXT="savedWords",LANGTEXT="lang",ITEMSTEXT="items",KEYTEXT="key",SAVEDTEXT="LastSearches",DATETEXT="date",defaultOptions={nSearch2Show:5,nDays2Expire:30},options={},preBuscador="#prebuscadorCabecera",funcPresearch=function(){function q(a){return a.replace(/[^A-Za-z0-9À-ÿ ]/g,"")}function t(a,e,d){document.cookie=a+"\x3d"+(e||"")+"; expires\x3d Thu, 01 Jan 1970 00:00:01 GMT; domain\x3d"+d+";path\x3d/;"}function p(){if("undefined"===typeof x){var a=window.location.hostname;-1!==a.indexOf("www")&&
(a=a.replace(/[0-9]+/,"").replace("www.",""));a=a.replace("pre.","").replace("pinternet.","").replace("..",".");x=a=0===a.indexOf(".")?a:"."+a}return x}function r(a,e,d,b,c){var f="";b&&(f=new Date,f.setTime(f.getTime()+864E5*b),f="; expires\x3d"+f.toUTCString());b=";SameSite\x3dLax";c&&(b=";SameSite\x3d"+c);document.cookie=a+"\x3d"+(e||"")+f+";domain\x3d"+d+";path\x3d/;"+b}function u(a){a+="\x3d";for(var e=document.cookie.split(";"),d=0;d<e.length;d++){for(var b=e[d];" "==b.charAt(0);)b=b.substring(1,
b.length);if(0==b.indexOf(a))return b.substring(a.length,b.length)}return null}function z(a){var e=new Map;if(a.hasOwnProperty(SAVEWORDTEXT)){a=a.savedWords;for(var d=0;d<a.length;d++)a[d].hasOwnProperty(LANGTEXT)&&e.set(a[d].lang.toLowerCase(),d)}return e}function A(a,e){for(var d=new Map,b=0;b<a.length;b++)if(a[b].hasOwnProperty(KEYTEXT)&&a[b].key===e)return d.set(a[b].key,b);return d}function v(a,e,d){var b,c,f,l,g,h={es:"Eliminar",ca:"Eliminar",en:"Delete"},h=h.hasOwnProperty(e)?h[e]:h.es;b="";
"undefined"!==typeof NeoSearch&&(b=NeoSearch?NeoSearch.searchLink?NeoSearch.searchLink:NeoSearch.autoFetchLink.prebuscadorCabecera:"");c=NeoCommon.getBuscadorUrl(b);a.key=q(a.key);b=$.parseHTML("\x3cli\x3e");g=$.parseHTML("\x3cdiv class\x3dps-item-image\x3e");c=$.parseHTML('\x3ca href\x3d"'+c+a.key+'"title\x3d"'+a.key+'"\x3e');c=$(c).html(a.key);f=$.parseHTML("\x3cp class\x3dps-item-title\x3e");l=$.parseHTML("\x3cp class\x3dps-item-remove\x3e");a=$.parseHTML("\x3ca onClick\x3d\"funcPresearch.removedKey('"+
a.key+"','"+e+"','"+d+"')\"\x3e");a=$(a).html(h);l=$(l).html(a);f=$(f).html(c);b=$(b).html(g);b=$(b).append(f);return b=$(b).append(l)}function c(a){return a.items.filter(function(a,d,b){if(a.hasOwnProperty(DATETEXT))return a=a.date,a=new Date(a),d=new Date,a.setDate(a.getDate()+options.nDays2Expire),0>=d-a})}function m(a){var e=JSON.parse(u(SAVEDTEXT)),d=$("html").attr("lang");0<$(".ps-block.ps-save-searches").length&&$(".ps-block.ps-save-searches").remove();if(null!==e&&e.hasOwnProperty(SAVEWORDTEXT)&&
0<e.savedWords.length){for(var b=e.savedWords,y=$.parseHTML('\x3cli class\x3d"ps-block ps-save-searches"\x3e'),f=$.parseHTML('\x3cdiv class\x3d"ps-content"\x3e'),l=$.parseHTML("\x3cul\x3e"),g=[],h=0;h<b.length;h++){var k=b[h];if(k.hasOwnProperty(ITEMSTEXT)&&k.hasOwnProperty(LANGTEXT)&&k.lang===d&&0<k.items.length){k.items=c(k);k.items.reverse();for(var n=0;n<k.items.length;n++){var m=k.items[n];m.hasOwnProperty(DATETEXT)&&m.hasOwnProperty(KEYTEXT)&&g.push(v(m,d,a))}k.items.reverse()}}b=b.filter(function(a,
b){return 0<a.items.length});0<b.length?r(SAVEDTEXT,JSON.stringify(e),p(),defaultOptions.nDays2Expire,"Lax"):t(SAVEDTEXT,"",p());if(0<g.length){for(e=0;e<g.length;e++)l=$(l).append(g[e]);f=$(f).append(l);y=$(y).append(f);$(a+" .presearch-results").prepend(y)}}}var x;return{removedKey:function(a,c,d){var b=JSON.parse(u(SAVEDTEXT)),e=!0;if(null!==b&&b.hasOwnProperty(SAVEWORDTEXT)&&0<b.savedWords.length){for(var f=b.savedWords,l=0;l<f.length&&e;l++){var g=f[l];if(g.hasOwnProperty(ITEMSTEXT)&&g.hasOwnProperty(LANGTEXT)&&
g.lang===c&&0<g.items.length)for(var h=0;h<g.items.length&&e;h++){var k=g.items[h];k.hasOwnProperty(KEYTEXT)&&k.key===a&&(g.items.splice(h,1),e=!1,r(SAVEDTEXT,JSON.stringify(b),p(),defaultOptions.nDays2Expire,"Lax"))}g.hasOwnProperty(ITEMSTEXT)&&0===g.items.length&&!1===e&&(f=f.sort(function(a,b){return b.length-a.length}),f.pop(),r(SAVEDTEXT,JSON.stringify(b),p(),defaultOptions.nDays2Expire,"Lax"))}0===f.length&&t(SAVEDTEXT,"",p())}m(d)},getLastSearchKeys:m,getSuggestSearch:function(a,e){var d=JSON.parse(u(SAVEDTEXT)),
b=$("html").attr("lang");a=a.trim();0<$(".ps-block.ps-save-searches").length&&$(".ps-block.ps-save-searches").remove();if(null!==d&&d.hasOwnProperty(SAVEWORDTEXT)&&0<d.savedWords.length){for(var m=d.savedWords,f=$.parseHTML('\x3cli class\x3d"ps-block ps-save-searches"\x3e'),l=$.parseHTML('\x3cdiv class\x3d"ps-content"\x3e'),g=$.parseHTML("\x3cul\x3e"),h=[],k=0;k<m.length;k++){var n=m[k];if(n.hasOwnProperty(ITEMSTEXT)&&n.hasOwnProperty(LANGTEXT)&&n.lang===b&&0<n.items.length){n.items=c(n);n.items.reverse();
for(var q=0;q<n.items.length;q++){var w=n.items[q];w.hasOwnProperty(DATETEXT)&&w.hasOwnProperty(KEYTEXT)&&0<=w.key.indexOf(a)&&h.push(v(w,b,e))}n.items.reverse()}}m=m.filter(function(a,b){return 0<a.items.length});0<m.length?r(SAVEDTEXT,JSON.stringify(d),p(),defaultOptions.nDays2Expire,"Lax"):t(SAVEDTEXT,"",p());if(0<h.length){for(a=0;a<h.length;a++)g=$(g).append(h[a]);l=$(l).append(g);f=$(f).append(l);e+=" .search-result .presearch-results";$(f).insertBefore(e)}}},registerNewSearchKey:function(a){a=
q(a.trim());var c=JSON.parse(u(SAVEDTEXT)),d=$("html").attr("lang").toLowerCase();if(null===c)r(SAVEDTEXT,JSON.stringify({savedWords:[{lang:d,items:[{key:a,date:new Date}]}]}),p(),defaultOptions.nDays2Expire,"Lax");else{var b=z(c);0<b.size&&(b.has(d)?(d=c.savedWords[b.get(d)],d.hasOwnProperty(ITEMSTEXT)&&(d=d.items,b=A(d,a),0<b.size?(d[b.get(a)].date=new Date,d.sort(function(a,b){return new Date(b.date)-new Date(a.date)})):(d.length===options.nSearch2Show&&d.pop(),d.push({key:a,date:new Date}),d.sort(function(a,
b){return new Date(b.date)-new Date(a.date)})))):c.savedWords.push({lang:d,items:[{key:a,date:new Date}]}),r(SAVEDTEXT,JSON.stringify(c),p(),defaultOptions.nDays2Expire,"Lax"))}},putUtagLink:function(a,c,d){a=0===d.length?$(a+" label").text():a;d=0===d.length?"clic en boton":d;var b;b=JSON.parse('{"event_category":"buscador generico","event_action":"","event_label":"","page_internal_search_kw":""}');b.event_action=d;b.event_label=a;b.page_internal_search_kw=c;"function"===typeof callUtagLink&&callUtagLink(b)},
getTextWriteUser:function(a){return 0<$(a).length&&0<$(a)[0].value.length?$(a)[0].value:""},removeDisplay:function(){"none"===$("#prebuscadorCentral .search-result").css("display")&&$("#prebuscadorCentral .search-result").css("display","")}}}(),LastSearches=function(){function q(){var c=$(preBuscador).find("form");if(0<c.length)c.on("submit",function(){var c=funcPresearch.getTextWriteUser("#search-field");0<c.length&&(funcPresearch.putUtagLink(preBuscador,c,""),funcPresearch.registerNewSearchKey(c))})}
function t(){$(preBuscador+" .search").on("click",function(){var c=funcPresearch.getTextWriteUser("#search-field");0<c.length?funcPresearch.getSuggestSearch(c,preBuscador):funcPresearch.getLastSearchKeys(preBuscador)})}function p(){$(preBuscador+" .search").on("keyup",function(c){c=funcPresearch.getTextWriteUser("#search-field");0<c.length?funcPresearch.getSuggestSearch(c,preBuscador):0<$(".ps-block.ps-save-searches").length&&$(".ps-block.ps-save-searches").remove()})}function r(){$(preBuscador+" .search-result").on("click",
function(c){c=$(c.target).parents("a").attr("title");var m=funcPresearch.getTextWriteUser("#search-field");funcPresearch.putUtagLink(c,m,"clic en sugerencia")})}function u(){$("#prebuscadorCentral .search").on("click",function(){funcPresearch.removeDisplay();var c=funcPresearch.getTextWriteUser("#search-field-central");0<c.length?funcPresearch.getSuggestSearch(c,"#prebuscadorCentral"):funcPresearch.getLastSearchKeys("#prebuscadorCentral")})}function z(){var c=$("#search-field-central");0<c.length&&
(c=c.next(),c.on("click",function(){var c=funcPresearch.getTextWriteUser("#search-field-central");0<c.length&&(funcPresearch.putUtagLink("#prebuscadorCentral",c,""),funcPresearch.registerNewSearchKey(c))}))}function A(){$("#prebuscadorCentral .search").on("keyup",function(c){funcPresearch.removeDisplay();c=funcPresearch.getTextWriteUser("#search-field-central");0<c.length?funcPresearch.getSuggestSearch(c,"#prebuscadorCentral"):0<$(".ps-block.ps-save-searches").length&&$(".ps-block.ps-save-searches").remove()})}
function v(){$("#prebuscadorCentral .search-result").on("click",function(c){c=$(c.target).parents("a").attr("title");var m=funcPresearch.getTextWriteUser("#search-field-central");funcPresearch.putUtagLink(c,m,"clic en sugerencia")})}return{init:function(c){$.extend(options,defaultOptions,c);preBuscador=0<$("#prebuscadorCabecera").length?preBuscador:"#prebuscadorEMPCabecera";-1!==window.location.hostname.indexOf("caixabank.es")&&(q(),t(),p(),r());$(window).on("load",function(){-1===window.location.hostname.indexOf("caixabank.es")&&
(q(),t(),p(),r());u();z();A();v()})}}}();